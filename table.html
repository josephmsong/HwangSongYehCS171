<!DOCTYPE html>
<html lang="en">
<head>
<style type="text/css">
  
    img {
      width:20%;
      height:20%;
      background-repeat: no-repeat;
      background-position: 50%;
     }

    div#averageBarDiv {
      float:left;
      width:40%;
      height:300px;
    }

    .text {
      padding-left: 70px;
    }
    
    tr:nth-child(even) {
      background-color: lightgray;
    }
    tr:nth-child(odd) {
      background-color: white;
    }
    table {
        border-collapse: collapse;
    }
    table, th, td, caption {
        border: 1px solid #888888;
    }

    th, td, caption {
      padding: 3px;
    }

    .playerimg {
      float:left;
      margin: 20px;
    }

    .teamimg {
      float:left;
      margin-left: 50px;
      background-repeat: no-repeat;
      background-position: 50%;
      border-radius: 50%;
    }

</style>

</head>
<meta charset="utf-8">
  <body>

    <div id="container">
    <div id="playerimg"></div>
    <div id="teamimg"></div>
    <div id="playerdetails"></div>
    <div class= "text">
   
  </div>


    <br>

    <div id = "averageBarDiv"> </div>

    <script src="http://d3js.org/d3.v3.min.js"></script>

    <script>

    this.margin = {top: 20, right: 30, bottom: 30, left: 100},
    this.width = 400 - this.margin.left - this.margin.right,
    this.height = 540 - this.margin.top - this.margin.bottom;
   

		var playerData
			d3.json('data/nba.json', function(error, data){
      playerData = data[78];

      // averageDisplayData is the array with differences between this year and the average
      var averageDisplayData = [];

      // desireindex is the name, age, weight etc.
      var desireindex = [0, 2, 3, 5, 8]

      // avgIndex is the list of indices that we want
      var avgIndex = ["apg", "bpg", "fg3perc", "fgperc", "ftperc", "ppg", "rpg", "spg"]

      averageDisplayData = wrangleData(playerData.seasons);

      initAverageBars(averageDisplayData);


      // wrangleData will be used to create an array of the differences
      function wrangleData(data){

        var currentSeasonIndex = data.length - 2;
        var averageSeasonIndex = currentSeasonIndex + 1;

        console.log(data[currentSeasonIndex]);

        // avgData is the data that we'll be using
        var avgData = [];

        // go through and take the differences

        for(var field in data[currentSeasonIndex]){

          if(data[currentSeasonIndex].hasOwnProperty(field)){

            // if this field is of interest to us
            if(avgIndex.indexOf(field) > -1){

              // calculate values for cleanliness
              var currentSeasonValue = data[currentSeasonIndex][field];
              var averageSeasonValue = data[averageSeasonIndex][field];

              // store the difference
              avgData.push(currentSeasonValue-averageSeasonValue);
            }
          }
        }

        return avgData;


      }

      // createAverageBars takes the processed data array of differences and creates the bar chart
      function initAverageBars(data){

        var that = this;

        var avgDiv = d3.select("#averageBarDiv")

        this.svg = avgDiv
          .append("svg")
          .attr("width", this.width + this.margin.left + this.margin.right)
          .attr("height", this.height + this.margin.top + this.margin.bottom)
        .append("g")
          .attr("transform", "translate(" + this.margin.left + "," + this.margin.top + ")");

        this.x = d3.scale.linear()
          .range([0, this.width]);

        this.y = d3.scale.ordinal()
            .rangeRoundBands([0, this.height/2], .2);

        this.xAxis = d3.svg.axis()
          .scale(this.x)
          .orient("top");

        // this.yAxis = d3.svg.axis()
        //   .scale(this.y)
        //   .orient("left");

        this.area = d3.svg.area()
          .interpolate("monotone")
          .x1(function(d) {return that.x(d); })
          .x0(0)
          .y1(function(d, i) {return that.y(i);});

        this.svg.append("g")
            .attr("class", "x axis")
            .attr("transform", "translate(0," + this.height/2 + ")")

        this.svg.append("g")
            .attr("class", "y axis")
          .append("text")
            .attr("x", 170)
            .attr("y", -12)
            .attr("dy", ".71em")
            .style("text-anchor", "end")
            .text("Comparison to Average")
          .append("line")
            .attr("x1", 0)
            .attr("x2", 0)
            .attr("y2", this.height);


        var x0 = Math.max(-d3.min(data), d3.max(data));

        this.x.domain([-x0, x0]);
        this.x.nice();

        this.y.domain(d3.range(data.length));

        // updates axes
        this.svg.select(".x.axis")
            .call(this.xAxis);

        // this.svg.select(".y.axis")
        // .call(this.yAxis)

        d3.selectAll(".avgBars").remove();
        d3.selectAll(".barsLabel").remove();

        if(!isNaN(data[0])){

            var groups = this.svg.append("g")
                        .selectAll("g.row")
                        .data(data)
                        .enter()
                        .append("g")
                        .attr("class", "row");

            var bars = groups
                        .append("rect")
                        .attr("x", function (d, i) {return that.x(Math.min(0, d));})
                        .attr("y", function (d,i) {return that.y(i);})
                        .attr("width", function(d, i){return Math.abs(that.x(d) - that.x(0));})
                        .attr("height", this.y.rangeBand())
                        .attr("class", "avgBars")
                        .attr("fill", function(d){
                            // if this is a negative value
                            if(d < 0){
                                return "red";
                            }

                            else
                                return "green";
                        });
                        // .on("mouseover", function(d, i){
                        //     d3.select(this).style("fill", "grey");
                        //     that.showHover(i);
                        // })
                        // .on("mouseout", function(d, i){

                        //     if(d< 0){
                        //         d3.select(this).style("fill", "red");
                        //     }

                        //     else
                        //         d3.select(this).style("fill", "green");

                        //     that.svg.selectAll(".prioInfo").remove();
                        // })
          }

      }
      
   
     var imgaa = d3.select("#playerimg")

     var image = imgaa.selectAll("img")
                .data([77])
                .enter().append("img")
                .attr("class","playerimg")
                .attr("src", data[78]["photo"])
              

     var text = d3.select("#playerdetails")

     
     var team = d3.select("#teamimg")

     var teamimg = team.selectAll("img")
     					.data([1])
     					.enter().append("img")
     					.attr("class", "teamimg")	
     					.attr("src", "http://stats.nba.com/media/img/teams/logos/LAL_logo.svg")		


  		var columns = Object.keys(playerData.seasons[0]);


       console.log(columns)
     
				var table = d3.select("body").append("table"),
          thead = table.append("thead")
                       .attr("class", "thead");
          tbody = table.append("tbody");

          table.append("caption")
            .html("NBA Individual Stats");

          // add header names
          thead.append("tr").selectAll("th")
           .data(columns)
           .enter()
           .append("th")
           .text(function(d) { return d; })

          var rows = tbody.selectAll("tr.row")
            .data(playerData.seasons)
            .enter()
            .append("tr").attr("class", "row");

          //populates each cell using JSON file
          var cells = rows.selectAll("td")
            .data(function(row) {	
  						 return d3.range(Object.keys(row).length).map(function(column, i) {
                  return row[Object.keys(row)[i]];
              });
            })
            .enter()
            .append("td")
            .text(function(d) { return d; })

			
		// 		var table = d3.select("body").append("table"),
  //         thead = table.append("thead")
  //                      .attr("class", "thead");
  //         tbody = table.append("tbody");

  //         table.append("caption")
  //           .html("NBA Individual Stats");

  //         // add header names
  //         var cols = thead.append("tr").selectAll("th")
  //          .data([data[78]])
  //          .enter()
  //          .append("th")
  //          

  //         var rows = tbody.selectAll("tr.row")
  //           .data(agecol)
  //           .enter()
  //           .append("tr").attr("class", "row")
  // 					.text(function(d) { return d; })
  //         //populates each cell using JSON file
  //         var cells = cols.selectAll("td")
  //           .data(function(row) {	
  // 						 return desireindex.map(function(col, i) {
  //                 return row[Object.keys(row)[desireindex[i]]]	;
  //             });
  //           })
  //           .enter()
  //           .append("td")
  //           .text(function(d) { return d; })



				   // this.svg = d3.select("body").append("svg")
				   //      .attr("width", this.width + this.margin.left + this.margin.right)
				   //      .attr("height", this.height + this.margin.top + this.margin.bottom)
				   //      .append("g")
				   //      .attr("transform", "translate(" + 300+ "," + this.margin.top+ ")");

				   //  this.svg.append("text")
				   //      .text("Comparison to Average")
				   //      .attr("x",-200)
				   //      .attr("y",-10)
				   //  // creates axis and scales
				   //  scale= d3.scale.linear()
				   //    .range([-this.width,this.width])
				    
				   //  this.yscale = d3.scale.ordinal()
				   //    .rangeRoundBands([0,this.height],.1)

				   //  this.color = d3.scale.category20();

				   //  this.xAxis = d3.svg.axis()
				   //    .scale(this.x)
				   //    .orient("bottom");

				   //  this.yAxis = d3.svg.axis()
				   //    .scale(this.yscale)
				   //    .orient("left");

				 
				   //  // Add axes visual elements
				   //  this.svg.append("g")
				   //    .attr("class", "x axis")
				   //    .attr("transform", "translate(0," + this.height+ ")");
				   //  this.svg.append("g")
				   //    .attr("class", "y axis")
				   //    .attr("transform", "translate(0,"  + 0+ ")");

							// this.yscale.domain(stats)
					  //   // // updates graph
					  //   var bar = this.svg.selectAll(".bar")
					  //               .data(playerData.seasons)
					            
					  //    var bar_enter =  bar.enter()
					  //               .append("rect")
					  //               .attr("class", "bar2")
					  //               .attr("opacity",.6)
					  //               .attr("x", function(d){ return d.seasons; })
					  //               .attr("y", function(d,i){ return 10*i})       
					  //               .attr("width",function(d){ return d.seasons })    
					  //               .attr("height", function(d,i) {
					  //                  return 20;})
					              
					  // this.svg.select(".y.axis")
					  //       .call(this.yAxis)
					  //       .selectAll("text")
					  //       .attr("x",-300)
					  //       .attr("y",-10)
					  //       .attr("style", "text-anchor:center");


    })

	


</script> 
  </div>
  </body>
</html>