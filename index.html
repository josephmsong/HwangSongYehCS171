<!DOCTYPE html> 
<html>
<head>
  <title>Ball Is Life</title>

  <style> 

    ul {
      list-style-type: none;
      margin: 0;
      padding: 0;
      overflow: hidden;
    }

    li {
      float: left;
    }

    a {
      display: block;
      width: 170px;
      background-color: #dddddd;
    }

  </style>

  <script src="libs/d3/d3.min.js" charset="utf-8"></script>
  <script src="https://code.jquery.com/jquery-1.11.2.min.js"></script>
  <script src="libs/bootstrap/js/bootstrap.min.js" charset="utf-8"></script>
  <script src="http://d3js.org/queue.v1.min.js"></script>

</head>

<body>

  <ul id = "teamlist"></ul>

  <br>

  <ul id = "playerlist"></ul>

</body>

<script>

  // array that stores team names
  var teamNamesList = ["Atlanta Hawks", "Boston Celtics", "Brooklyn Nets", "Charlotte Hornets", "Chicago Bulls", "Cleveland Cavaliers", "Dallas Mavericks", "Denver Nuggets", "Detroit Pistons", "Golden State Warriors", "Houston Rockets", "Indiana Pacers", "Los Angeles Clippers", "Los Angeles Lakers", "Memphis Grizzlies", "Miami Heat", "Milwaukee Bucks", "Minnesota Timberwolves", "New Orleans Pelicans", "New York Knicks", "Oklahoma City Thunder", "Orlando Magic", "Philadelphia 76ers", "Phoenix Suns", "Portland Trail Blazers", "Sacramento Kings", "San Antonio Spurs", "Toronto Raptors", "Utah Jazz", "Washington Wizards"];

  // teamPlayersList will contain the list of players for the team selected from the first navbar
  var teamPlayersList;

  // playerData contains the data that'll be loaded from the JSON
  var playerData;

  // teamLookup is an object used to wrangle together the players from a selected team
  var teamLookup = {"ATL": 0, "BOS": 1, "BKN": 2, "CHA": 3, "CHI": 4, "CLE": 5, "DAL": 6, "DEN": 7, "DET": 8, "GS": 9, "HOU": 10, "IND": 11, "LAC": 12, "LAL": 13, "MEM": 14, "MIA": 15, "MIL": 16, "MIN": 17, "NO": 18, "NY": 19, "OKC": 20, "ORL": 21, "PHI": 22, "PHO": 23, "POR": 24, "SAC": 25, "SA": 26, "TOR": 27, "UTA": 28, "WAS": 29}
  
  // function to create the team navigation bar
  function loadTeamNavBar(_data){

    // playerData = _data;

    teamList = d3.select("#teamlist");

    var teamLinks = teamList.selectAll("li")
                        .data(teamNamesList)
                        .enter().append("li")
                        .html(function(d, i){return "<a href = '#' onclick =showPlayers("+i+")>" + teamNamesList[i] + "</a>";})

  }

  // showPlayers takes in the index of the team that was clicked and shows the players of that team
  function showPlayers(teamIndex){

    // remove whatever list there was previously
    d3.selectAll(".playerList").remove();

    // get a list of the players on that team
    teamPlayersList[teamIndex] = aggregatePlayers(teamIndex);

    playerList = d3.select("#playerlist");

    var teamPlayers = playerList.selectAll("li")
                                .data(teamPlayersList[teamIndex])
                                .enter().append("li")
                                .attr("class", "playerList")
                                .html(function(d, i){return "<a href = '#'>" + teamPlayersList[teamIndex][i].name + "</a>";})

  }

  // aggregatePlayers is used to get the list of players for a selected team
  function aggregatePlayers(teamIndex){

    // first check to see if we've already created the list for this team
    if(isEmpty(teamPlayersList[teamIndex])){

      return teamPlayersList[teamIndex];
    }

    // if we haven't already clicked on this team, round up the players
    else{

      return playerData.filter(function(d, i, array){

        return teamLookup[d.team] == teamIndex;

      })
    }

  }

    // initVis loads the data
  function initVis(){

    // initialize the teamPlayersList
    teamPlayersList = get2DArray(30);  

    d3.json('data/nba.json', function(error, data){
      playerData = data;

    })

    loadTeamNavBar();

  // this wasn't working
  //   queue()
  //     .defer(d3.json, 'data/nba.json')
  //     .await(loadTeamNavBar);
  // }
  }
  /* 
  * HELPER FUNCTIONS BELOW
  */

  // function to create an empty 2D-array. We'll use this to setup memoization 
  //for team players so we don't need to iterate too much over the large JSON file that we have
  // source: http://stackoverflow.com/questions/6495187/best-way-to-generate-empty-2d-array
  function get2DArray(size) {
    size = size > 0 ? size : 0;
    var arr = [];

    while(size--) {
        arr.push([]);
    }

    return arr;
  }

  // isEmpty checks to see if an array is empty
  // source: http://stackoverflow.com/questions/11743392/check-if-array-is-empty-or-exists
  function isEmpty(array){

    return typeof array != "undefined"
      && array != null
      && array.length != null
      && array.length > 0
  }


  initVis();

</script> 
</html>