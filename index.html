<!DOCTYPE html> 
<html>
<head>
  <title>Ball Is Life</title>

  <style> 
    ul {
      list-style-type: none;
      margin: 0;
      padding: 0;
      overflow: hidden;
    }
    li {
      float: left;
    }
    a {
      display: block;
      width: 170px;
      background-color: #dddddd;
    }
    img{
      width:3.2%;
      height:3.2%;
      background-repeat: no-repeat;
      background-position: 50%;
      border-radius: 50%;
    }
    .playerList {
      margin: 10px;
      width: 50px;
      height: 50px;
      background-color: #d3d3d3;
    }
    div#teamlist {
      background-color: #0099FF;
      /* Firefox */
      display:-moz-box;
      -moz-box-pack:center;
      -moz-box-align:center;
      /* Safari and Chrome */
      display:-webkit-box;
      -webkit-box-pack:center;
      -webkit-box-align:center;
      /* W3C */
      display:box;
      box-pack:center;
      box-align:center;
    }
    div.playerlist {
      background-color: #00CCFF;
      /* Firefox */
      display:-moz-box;
      -moz-box-pack:center;
      -moz-box-align:center;
      /* Safari and Chrome */
      display:-webkit-box;
      -webkit-box-pack:center;
      -webkit-box-align:center;
      /* W3C */
      display:box;
      box-pack:center;
      box-align:center;
    }
     tr:nth-child(even) {
      background-color: lightgray;
    }
    tr:nth-child(odd) {
      background-color: white;
    }
    table {
        border-collapse: collapse;
    }
    table, th, td, caption {
        border: 1px solid #888888;
    }

    th, td, caption {
      padding: 3px;
    }
    .axis path,
.axis line {
  fill: none;
  stroke: #000;
  shape-rendering: crispEdges;
}

.bar {
  fill: steelblue;
}

.bar{
    opacity: .2;
  }
.bar--not{
  opacity:.5;

}
.x.axis path {
  display: none;
}
.d3-tip {
  line-height: 1;
  font-weight: bold;
  padding: 12px;
  background: rgba(0, 0, 0, 0.8);
  color: #fff;
  border-radius: 2px;
}

/* Creates a small triangle extender for the tooltip */
.d3-tip:after {
  box-sizing: border-box;
  display: inline;
  font-size: 10px;
  width: 100%;
  line-height: 1;
  color: rgba(0, 0, 0, 0.8);
  content: "\25BC";
  position: absolute;
  text-align: center;
}

/* Style northward tooltips differently */
.d3-tip.n:after {
  margin: -1px 0 0 0;
  top: 100%;
  left: 0;
}
svg {
  font: 10px sans-serif;
}

.area1 {
  fill: #C0C0C0;
  clip-path: url(#clip);
}
.area2{
  fill: #404040;
  clip-path: url(#clip);

}

.axis path,
.axis line {
  fill: none;
  stroke: #000;
  shape-rendering: crispEdges;
}

.brush .extent {
  stroke: #fff;
  fill-opacity: .125;
  shape-rendering: crispEdges;
}
  </style>

  <script src="libs/d3/d3.min.js" charset="utf-8"></script>
  <script src="https://code.jquery.com/jquery-1.11.2.min.js"></script>
  <script src="libs/bootstrap/js/bootstrap.min.js" charset="utf-8"></script>
  <script src="http://d3js.org/queue.v1.min.js"></script>
  <script src="http://d3js.org/d3.v3.min.js"></script>
<script src="http://d3js.org/d3.v3.min.js"></script>
<script src="http://labratrevenge.com/d3-tip/javascripts/d3.tip.v0.6.3.js"></script>

</head>

<body>

  <div id = "teamlist"></div>

  <ul id = "playerlist"></ul>

  <br>

  <div id = "teamNameDiv"> </div>

  <br>

  <div id = "playerNameDiv"></div>

  <br> 

  <div id = "compareBarsDiv"></div>

  <br> 

  <div id="container">
  <div id="playerimg" style="height:85%;width:85%"></div>
  <div id="teamimg"></div>
  <div id="playerdetails"></div>
  <div class= "text">
  <div id="playerName"></div>
  <div id = "averageBarDiv"> </div>
   <div  class = "col-md-9" id = "tableDiv"> </div>
   <div class="col-md-3" id="brushDiv"></div>
            


<script>
  // array that stores team names
  var teamNamesList = ["Atlanta Hawks", "Boston Celtics", "Brooklyn Nets", "Charlotte Hornets", "Chicago Bulls", "Cleveland Cavaliers", "Dallas Mavericks", "Denver Nuggets", "Detroit Pistons", "Golden State Warriors", "Houston Rockets", "Indiana Pacers", "Los Angeles Clippers", "Los Angeles Lakers", "Memphis Grizzlies", "Miami Heat", "Milwaukee Bucks", "Minnesota Timberwolves", "New Orleans Pelicans", "New York Knicks", "Oklahoma City Thunder", "Orlando Magic", "Philadelphia 76ers", "Phoenix Suns", "Portland Trail Blazers", "Sacramento Kings", "San Antonio Spurs", "Toronto Raptors", "Utah Jazz", "Washington Wizards"];
  // teamPlayersList will contain the list of players for the team selected from the first navbar
  var teamPlayersList = Array.apply(null, new Array(30)).map(Number.prototype.valueOf,0);;
  // playerData contains the data that'll be loaded from the JSON
  var playerData;
  // teamLookup is an object used to wrangle together the players from a selected team
  var teamLookup = {"ATL": 0, "BOS": 1, "BKN": 2, "CHA": 3, "CHI": 4, "CLE": 5, "DAL": 6, "DEN": 7, "DET": 8, "GS": 9, "HOU": 10, "IND": 11, "LAC": 12, "LAL": 13, "MEM": 14, "MIA": 15, "MIL": 16, "MIN": 17, "NO": 18, "NY": 19, "OKC": 20, "ORL": 21, "PHI": 22, "PHO": 23, "POR": 24, "SAC": 25, "SA": 26, "TOR": 27, "UTA": 28, "WAS": 29}
  var playerNamesList = [];
  var svg;
  // function to create the team navigation bar
  function loadTeamNavBar(_data){
    // playerData = _data;
    teamList = d3.select("#teamlist");
    // var teamLinks = teamList.selectAll("li")
    //                     .data(teamNamesList)
    //                     .enter().append("li")
    //                     .html(function(d, i){return "<a href = '#' onclick =showPlayers("+i+")>" + teamNamesList[i] + "</a>";})
    var teamLinks = teamList.selectAll("img")
                            .data(teamNamesList)
                            .enter().append("img")
                            .attr("src", function(d, i){
                              // teamAbbrev will be used to determine the link
                              var teamAbbrev;
                              // make adjustments for exceptions
                              switch(i){
                                case 9: 
                                  teamAbbrev = "GSW";
                                  break;
                                case 18:
                                  teamAbbrev = "NOP";
                                  break;
                                case 19:
                                  teamAbbrev = "NYK";
                                  break;
                                case 23:
                                  teamAbbrev = "PHX";
                                  break;
                                case 26: 
                                  teamAbbrev = "SAS";
                                  break;
                                default:
                                  teamAbbrev = reverseLookup(i);
                                  break;
                              }
                              return "http://stats.nba.com/media/img/teams/logos/"+teamAbbrev+"_logo.svg";
                            })
                            .attr("id", function(d, i){return reverseLookup[i];})
                            .attr("onclick", function(d, i){
                              d3.select("#"+reverseLookup[i])
                                .style("border", "10px solid black");
                              return "showTeamName("+i+"); showPlayers("+i+")";

                            })
                            .on("click", function(d, i){
                                 d3.selectAll(".averageBars").remove();
                                 d3.selectAll("svg").remove();
                                  d3.selectAll(".compareBarsDiv").remove();
                                  d3.select(".teamimg").remove();
                                  d3.select(".playerimg").remove();
                                  d3.select(".table").remove();
                                  d3.selectAll(".brush").remove();
                                  stacked(reverseLookup(i));
                                  brush(reverseLookup(i));
                                    // maketablechart(ID);
                                    // window.location.href = "table.html?id=" + ID;
                            });
  }
  function brush(team){
   var margin = {top: 10, right: 10, bottom: 100, left: 0},
    margin2 = {top: 330, right: 10, bottom: 20, left: 0},
    width = 600 - margin.left - margin.right,
    height = 400 - margin.top - margin.bottom,
    height2 = 400 - margin2.top - margin2.bottom;
  // var parseDate = d3.time.format("%b %Y").parse;

  var x = d3.time.scale().range([0, width]),
      x2 = d3.time.scale().range([0, width]),
      y = d3.scale.linear().range([height, 0]),
      y2 = d3.scale.linear().range([height2, 0]);

  var xAxis = d3.svg.axis().scale(x).orient("bottom"),
      xAxis2 = d3.svg.axis().scale(x2).orient("bottom"),
      yAxis = d3.svg.axis().scale(y).orient("left");

  var brush = d3.svg.brush()
      .x(x2)
      .on("brush", brushed);

  var area = d3.svg.area()
      .interpolate("monotone")
      .x(function(d) { return x(d.year); })
      .y0(height)
      .y1(function(d) { return y(d.win); });
var area3 = d3.svg.area()
      .interpolate("monotone")
      .x(function(d) { return x(d.year); })
      .y0(height)
      .y1(function(d) { return y(d.loss); });

  var area2 = d3.svg.area()
      .interpolate("monotone")
      .x(function(d) { return x2(d.year); })
      .y0(height2)
      .y1(function(d) { return y2(d.win); });

  var svg = d3.select("body").append("svg")
      .attr("class", "brush")
      .attr("width", width + margin.left + margin.right)
      .attr("height", height + margin.top + margin.bottom);

  svg.append("defs").append("clipPath")
      .attr("id", "clip")
    .append("rect")
      .attr("width", width)
      .attr("height", height);

  var focus = svg.append("g")
      .attr("class", "focus")
      .attr("transform", "translate(" + margin.left + "," + margin.top + ")");

  var context = svg.append("g")
      .attr("class", "context")
      .attr("transform", "translate(" + margin2.left + "," + margin2.top + ")");

  d3.json("data/nbateams.json", function(error, data) {
    var teamdata = data.filter(function(d){return d.name==team});
    console.log(teamdata[0].years)
    var parseDate = d3.time.format("%Y").parse;

        
          teamdata[0].years.forEach(function(d,i){
            if(parseDate(d.year.substring(0,4))!= null)
              d.year = parseDate(d.year.substring(0,4))
            // else
              // d.year = parseDate("2005")

          })
        // console.log(team.years)
  x.domain(d3.extent(teamdata[0].years.map(function(d) { return d.year; })));
  y.domain([0, d3.max(teamdata[0].years.map(function(d) { return d.win; }))]);
  x2.domain(x.domain());
  y2.domain(y.domain());


  focus.append("path")
      .datum(teamdata[0].years)
      .attr("class", "area1")
      .attr("d", area)

  focus.append("g")
      .attr("class", "x axis")
      .attr("transform", "translate(0," + height + ")")
      .call(xAxis);

  focus.append("g")
      .attr("class", "y axis")
      .call(yAxis);

  context.append("path")
      .datum(teamdata[0].years)
      .attr("class", "area2")
      .attr("d", area2);

  context.append("g")
      .attr("class", "x axis")
      .attr("transform", "translate(0," + height2 + ")")
      .call(xAxis2);

  context.append("g")
      .attr("class", "x brush")
      .call(brush)
    .selectAll("rect")
      .attr("y", -6)
      .attr("height", height2 + 7);
});

function brushed() {
  x.domain(brush.empty() ? x2.domain() : brush.extent());
  focus.select(".area1").attr("d", area);
  focus.select(".x.axis").call(xAxis);
}

function type(d) {
  d.date = parseDate(d.date);
  d.price = +d.price;
  return d;
}

  }
  function stacked(team)
  {
    var playerDatas;
    var svg;
    var color;
    var margin = {top: 45, right: 5, bottom: 30, left: 5},
    width = 50,
    legwidth = 100;
    height = 400 - margin.top - margin.bottom;
  // filter the data based on specific team selected 
    var data = playerData.filter(function(d){return d.team==team});

    //load the data
    function wranglestackedData(value){
      var indPlayerData= data.map(function(d){
      
      // format the data into an array that consolidates players stats
        return {
          ppg: d.seasons[d.seasons.length-2]["ppg"],
          assists: d.seasons[d.seasons.length-2]["assists"],
          blocks: d.seasons[d.seasons.length-2]["blocks"], 
          fga: d.seasons[d.seasons.length-2]["fga"],
          rpg: d.seasons[d.seasons.length-2]["rpg"],
          turnovers: d.seasons[d.seasons.length-2]["turnovers"],
          minutes: d.seasons[d.seasons.length-2]["minutes"],
          steals: d.seasons[d.seasons.length-2]["steals"],
          reb: d.seasons[d.seasons.length-2]["reb"],
          
          name:d.name
          //steals: d.seasons[d.seasons.length-1]["steals"]
        }
      });

      var ppg = [];
      var assists = [];
      var blocks = [];
      var names = [];
      var fga = [];
      var rpg = [];
      var turnovers = [];
      var minutes = [];
      var steals = [];
      var reb = [];

      for(var i=0; i< indPlayerData.length; i++)
      {
        ppg[i] = indPlayerData[i].ppg;
        assists[i] = indPlayerData[i].assists;
        blocks[i] = indPlayerData[i].blocks;
        names[i] = indPlayerData[i].name;
        fga[i] = indPlayerData[i].fga;
        rpg[i] = indPlayerData[i].rpg;
        turnovers[i] = indPlayerData[i].turnovers;
        steals[i] = indPlayerData[i].steals;
        minutes[i] = indPlayerData[i].minutes;
        reb[i] = indPlayerData[i].reb;
      }

      var rawr = [ppg,assists,blocks, fga, rpg, turnovers, steals, minutes, reb];

      //var steals = [];
      var list = ["ppg", "assists", "blocks", "fga", "rpg", "turnovers", "steals", "minutes", "reb"]
      var index = list.indexOf(value);

      var total = [0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0];
      total[1] = rawr[index][1]
      for(var j = 1; j<rawr[index].length; j++)
      {
        // console.log(total[j])
        total[j] = rawr[index][j-1] + total[j-1]
      }

      var team= {x:value, y:rawr[index], total:total, name:names}

      return team;
    }  

    function drawBar (array){

    var x = d3.scale.ordinal()
        .rangeRoundBands([0, width], .1);

    var y = d3.scale.linear()
        .range([320,0]);

    color = d3.scale.category20c()

    // instantiate axis
    var xAxis = d3.svg.axis()
        .scale(x)
        .orient("bottom");

    var yAxis = d3.svg.axis()
        .scale(y)
        .orient("left")
        .tickFormat(d3.format(".2s"));

    // create svg
    svg = d3.select("body").append("svg")
    .attr("class", "rawr")
        .attr("width", width + margin.left + margin.right)
        .attr("height", height + margin.top + margin.bottom)
      .append("g")
        .attr("transform", "translate(" + margin.left + "," + margin.top + ")");
        var tip = d3.tip()
        .attr('class', 'd3-tip')
        .offset([-40, 0])
        .html(function(d,i) {
          return array.name[i] + ": " + d  ;
        })

      svg.call(tip)
      x.domain(array.x);
      y.domain([0, d3.max(array.total, function(d){return d})])

     svg.append("g")
          .attr("class", "x axis")
          .attr("transform", "translate(0," + height + ")")
          // .call(xAxis);

      svg.append("g")
          .attr("class", "y axis")
          // .call(yAxis)
        .append("text")
        .attr("class", "rawr")
          .attr("transform", "rotate(-90)")
          .attr("y", 6)
          .attr("dy", ".71em")
          .style("text-anchor", "center")
          .text(array.x);

      var state = svg.selectAll(".state")
          .data(array.y)
        .enter().append("g")
          .attr("class", "g")
          // .attr("transform", function(d) { return "translate(" + x(team.x) + ",0)"; });

     var bar=  state.selectAll("rect")
         
          .data(array.y)
        .enter().append("rect")
          .attr("width", 30)
           .attr("class", "rawr")
          .attr("y", function(d,i) { return height-y(array.total[i])})
          .attr("height", function(d,i) { return y(d)})
          .style("fill", function(d,i) { return color(i); })
           .on('mouseover', tip.show)
          .on('mouseout', tip.hide);


    }


    function addLegend(array){
      var legsvg = d3.select("body").append("svg")
        .attr("width", 100 + 50+ margin.right)
        .attr("height", height + margin.top + margin.bottom)
      .append("g")
        .attr("transform", "translate(" + 30 + "," + 0+ ")");

      var legend = legsvg.selectAll(".legend")
          .data(color.domain().slice().reverse())
        .enter().append("g")
          .attr("class", "legend")
          .attr("transform", function(d, i) { return "translate(40," + i * 20 + ")"; });

      legend.append("rect")
          .attr("class", "rawr")
          .attr("x", width - 18)
          .attr("width", 18)
          .attr("height", 18)
          .style("fill", function(d,i) {return color(i)});

      legend.append("text")

          .attr("x", width - 24)
          .attr("y", 9)
          .attr("dy", ".35em")
          .style("text-anchor", "end")
          .text(function(d,i) { return array.name[i]; });
      

    }
      drawBar(wranglestackedData("minutes"))
      drawBar(wranglestackedData("ppg"))
      drawBar(wranglestackedData("reb"))
      drawBar(wranglestackedData("assists"))
      drawBar(wranglestackedData("steals"))
      drawBar(wranglestackedData("blocks"))
      drawBar(wranglestackedData("turnovers"))

      addLegend(wranglestackedData("ppg"));
}

  // showPlayers takes in the index of the team that was clicked and shows the players of that team
  function showPlayers(teamIndex){
    // remove whatever list there was previously
    d3.selectAll(".playerList").remove();

    console.log("why doe");

    // get a list of the players on that team
    teamPlayersList[teamIndex] = aggregatePlayers(teamIndex);

    // console.log(aggregatePlayers(teamIndex))

    playerList = d3.select("#playerlist");
    var teamPlayers = playerList.append("div").attr("class","playerlist").selectAll("img")
                                .data(teamPlayersList[teamIndex])
                                .enter().append("img")
                                .attr("class", "playerList")
                                .attr("src", function(d, i){console.log("ay"); return teamPlayersList[teamIndex][i].photo;})
                                .on("mouseover", function(d,i){showPlayerName(teamPlayersList[teamIndex][i].name, teamPlayersList[teamIndex][i]);})
                                .on("mouseout", function(d, i){d3.selectAll(".compareBarsDiv").remove();d3.select("#playerNameDiv").html([""]);})
                                .on("click", function(d, i){
                                    var ID = playerNamesList.indexOf(teamPlayersList[teamIndex][i].name);
                                    d3.selectAll(".averageBars").remove();
                                    d3.selectAll("svg").remove();
                                    d3.selectAll(".compareBarsDiv").remove();
                                    d3.select("#playerNameDiv").html([""]);
                                    showPlayerPage(ID);
                                    // maketablechart(ID);
                                    // window.location.href = "table.html?id=" + ID;
                                  });
                                // .html(function(d, i){return "<a href = '#'>" + teamPlayersList[teamIndex][i].name + "</a>";})
  }
  // aggregatePlayers is used to get the list of players for a selected team
  function aggregatePlayers(teamIndex){

    // // first check to see if we've already created the list for this team
    // if(isEmpty(teamPlayersList[teamIndex])){
    //   return teamPlayersList[teamIndex];
    // }
    // // if we haven't already clicked on this team, round up the players
    // else{

      return playerData.filter(function(d, i, array){
        return teamLookup[d.team] == teamIndex && d.photo != "https://www.cbssports.com/images/players/unknown_player.gif" && d.photo != "https://www.cbssports.com/images/players/unknown-player-170x170.png";
      })
    // }
  }
  // showTeamName appends text to the page to show which team is currently selected
  function showTeamName(teamIndex){
    var teamName = d3.select("#teamNameDiv")
                     .attr("class", "teamNameDisplay")
                     .html(function(d, i){return "Selected team: " + teamNamesList[teamIndex];})
  }
  // showPlayerName shows the name of the player on hover
  // TO CHRISTINE: THIS IS WHERE THE CODE FOR A STACKED BAR CHART GOES
  function showPlayerName(playerName, player){
    d3.select("#playerNameDiv")
      .attr("class", "playerNameDisplay")
      .html(function(d, i){return "Player: " + playerName;}) 
    // var teamData = wrangleTeamData(player.team);
    // var thisPlayerData = showPlayerComparison(player);

  
    // this.margin = {top: 20, right: 30, bottom: 30, left: 100},
    // this.width = 100 - this.margin.left - this.margin.right,
    // this.height = 500 - this.margin.top - this.margin.bottom;
   
    // // Here is where the code starts to create the average bars
    // var that = this;
    // var avgDiv = d3.select("#compareBarsDiv")
    // this.svg = avgDiv.append("svg")
    //   .attr("width", this.width + this.margin.left + this.margin.right)
    //   .attr("height", this.height + this.margin.top + this.margin.bottom)
    //   .attr("class", "compareBarsDiv")
    // .append("g")
    //   .attr("transform", "translate(" + this.margin.left + "," + this.margin.top + ")");
    // this.x = d3.scale.linear()
    //   .range([0, this.width]);
    // this.y = d3.scale.ordinal()
    //     .rangeRoundBands([0, this.height/2], .2);
    // this.xAxis = d3.svg.axis()
    //   .scale(this.x)
    //   .orient("top");
    // this.area = d3.svg.area()
    //   .interpolate("monotone")
    //   .x1(function(d) {return that.x(d); })
    //   .x0(0)
    //   .y1(function(d, i) {return that.y(i);});
    // this.svg.append("g")
    //     .attr("class", "x axis")
    //     .attr("transform", "translate(0," + this.height/2 + ")")
    // this.svg.append("g")
    //     .attr("class", "y axis")
    //   .append("text")
    //     .attr("x", 170)
    //     .attr("y", -12)
    //     .attr("dy", ".71em")
    //     .style("text-anchor", "end")
    //     .text("Contribution to Team")
    //   .append("line")
    //     .attr("x1", 0)
    //     .attr("x2", 0)
    //     .attr("y2", this.height);
    // var x0 = Math.max(0, d3.max(teamData));
    // this.x.domain([0, x0]);
    // this.x.nice();
    // this.y.domain(d3.range(teamData.length));
    // // updates axes
    // this.svg.select(".x.axis")
    //     .call(this.xAxis);
    // // this.svg.select(".y.axis")
    // // .call(this.yAxis)
    // d3.selectAll(".avgBars").remove();
    // d3.selectAll(".barsLabel").remove();
    // if(!isNaN(teamData[0])){
    //     var groups = this.svg.append("g")
    //                 .selectAll("g.row")
    //                 .data(teamData)
    //                 .enter()
    //                 .append("g")
    //                 .attr("class", "row");
    //     var bars = groups
    //                 .append("rect")
    //                 .attr("x", 0)
    //                 .attr("y", function (d,i) {return that.y(i);})
    //                 .attr("width", function(d, i){return that.x(d);})
    //                 .attr("height", this.y.rangeBand())
    //                 .attr("class", "avgBars")
    //                 .attr("fill", "red")
    //     var groups2 = this.svg.append("g")
    //                 .selectAll("g.row")
    //                 .data(thisPlayerData)
    //                 .enter()
    //                 .append("g")
    //                 .attr("class", "row");
    //     var bars2 = groups2
    //                 .append("rect")
    //                 .attr("x", 0)
    //                 .attr("y", function (d,i) {return that.y(i);})
    //                 .attr("width", function(d, i){return that.x(d);})
    //                 .attr("height", this.y.rangeBand())
    //                 .attr("class", "avgBars")
    //                 .attr("fill", "green");

      
    //   }
    
  }

  function maketablechart (data){
    // console.log(data)
    var columns = Object.keys(data);
   
    var table = d3.select("#tableDiv").append("table").attr("class","table");
    var thead = table.append("thead").attr("class", "thead");
    var tbody = table.append("tbody");
    table.append("caption").html("NBA Individual Stats");

    thead.append("tr").selectAll("th")
              .data(columns)
              .enter()
              .append("th")
              .text(function(d){return d;})

    var rows = tbody.selectAll("tr.row")
                    .data(data.seasons)
                    .enter()
                    .append("tr").attr("class", "row");

    var cells = rows.selectAll("td")
                  .data(function(row){
                    return d3.range(Object.keys(row).length).map(function(column,i){
                      return row[Object.keys(row)[i]]
                    });
                  })
                  .enter()
                  .append("td")
                  .text(function(d){return d;})

 }
 //  // wrangle the data for a specific team to create the bar chart
  function wrangleTeamData(teamName){
    // console.log(teamName);
    var teamData = [0,0,0,0,0,0,0,0];
    var count = 0;
    // avgIndex is the list of indices that we want
    var avgIndex = ["apg", "bpg", "fg3perc", "fgperc", "ftperc", "ppg", "rpg", "spg"]
    playerData.map(function(d, i, array){
      count = 0; 
      // if this is a player on the team that we want
      if(d.team == teamName){
        var seasonData = d.seasons
        var currentSeasonIndex = seasonData.length -2;
        for(var field in seasonData[currentSeasonIndex]){
          if(seasonData[currentSeasonIndex].hasOwnProperty(field)){
            // if this field is of interest to us
            if(avgIndex.indexOf(field) > -1){
              // store the value
              teamData[count] += seasonData[currentSeasonIndex][field];
              count++;
            }
          }
        }
      }
    })
    return teamData;
  }
  function showPlayerComparison(playerData){
    var thisPlayerData = [];
    var currentSeasonIndex = playerData.seasons.length - 2;
        // avgIndex is the list of indices that we want
    var avgIndex = ["apg", "bpg", "fg3perc", "fgperc", "ftperc", "ppg", "rpg", "spg"]
    for(var i in avgIndex){
      thisPlayerData.push(playerData.seasons[currentSeasonIndex][avgIndex[i]]);
    }
    return thisPlayerData;
  }
  function showPlayerPage(playerID){
    this.margin = {top: 20, right: 30, bottom: 30, left: 100},
    this.width = 400 - this.margin.left - this.margin.right,
    this.height = 300 - this.margin.top - this.margin.bottom;
    // remove the old images to prepare for the new ones
    d3.select(".teamimg").remove();
    d3.select(".playerimg").remove();
    d3.select(".table").remove();
   
    var indPlayerData

    indPlayerData = playerData[playerID];
    console.log(indPlayerData)
    // averageDisplayData is the array with differences between this year and the average
    var averageDisplayData = [];
    // desireindex is the name, age, weight etc.
    var desireindex = [0, 2, 3, 5, 8]
    // avgIndex is the list of indices that we want
    var avgIndex = ["apg", "bpg", "fg3perc", "fgperc", "ftperc", "ppg", "rpg", "spg"]
    averageDisplayData = wrangleData(indPlayerData.seasons);
    // addPlayerName adds the player's name and position to the page
    addPlayerName(indPlayerData);
    // addTeamImage looks up the image for this player's team and puts it on the page
    addTeamImage(indPlayerData);
    initAverageBars(averageDisplayData);
    maketablechart(indPlayerData);

    // wrangleData will be used to create an array of the differences
    function wrangleData(data){
      var currentSeasonIndex = data.length - 2;
      var averageSeasonIndex = currentSeasonIndex + 1;
      console.log(data[currentSeasonIndex]);
      // avgData is the data that we'll be using
      var avgData = [];
      // go through and take the differences
      for(var field in data[currentSeasonIndex]){
        if(data[currentSeasonIndex].hasOwnProperty(field)){
          // if this field is of interest to us
          if(avgIndex.indexOf(field) > -1){
            // calculate values for cleanliness
            var currentSeasonValue = data[currentSeasonIndex][field];
            var averageSeasonValue = data[averageSeasonIndex][field];
            // store the difference
            avgData.push(currentSeasonValue-averageSeasonValue);
          }
        }
      }
      return avgData;
    }
    
   // createAverageBars takes the processed data array of differences and creates the bar chart
    function initAverageBars(data){
      var that = this;
      var avgDiv = d3.select("#averageBarDiv")
      this.svg = avgDiv
        .append("svg")
        .attr("width", this.width + this.margin.left + this.margin.right)
        .attr("height", this.height + this.margin.top + this.margin.bottom)
        .attr("class", "averageBars")
      .append("g")
        .attr("transform", "translate(" + this.margin.left + "," + this.margin.top + ")");
      this.x = d3.scale.linear()
        .range([0, this.width]);
      this.y = d3.scale.ordinal()
          .rangeRoundBands([0, this.height/2], .2);
      this.xAxis = d3.svg.axis()
        .scale(this.x)
        .orient("top");
      // this.yAxis = d3.svg.axis()
      //   .scale(this.y)
      //   .orient("left");
      this.area = d3.svg.area()
        .interpolate("monotone")
        .x1(function(d) {return that.x(d); })
        .x0(0)
        .y1(function(d, i) {return that.y(i);});
      this.svg.append("g")
          .attr("class", "x axis")
          .attr("transform", "translate(0," + this.height/2 + ")")
      this.svg.append("g")
          .attr("class", "y axis")
        .append("text")
          .attr("x", 170)
          .attr("y", -12)
          .attr("dy", ".71em")
          .style("text-anchor", "end")
          .text("Comparison to Average")
        .append("line")
          .attr("x1", 0)
          .attr("x2", 0)
          .attr("y2", this.height);
      var x0 = Math.max(-d3.min(data), d3.max(data));
      this.x.domain([-x0, x0]);
      this.x.nice();
      this.y.domain(d3.range(data.length));
      // updates axes
      this.svg.select(".x.axis")
          .call(this.xAxis);
      // this.svg.select(".y.axis")
      // .call(this.yAxis)
      d3.selectAll(".playerAvgBars").remove();
      d3.selectAll(".barsLabel").remove();
      if(!isNaN(data[0])){
          var groups = this.svg.append("g")
                      .selectAll("g.row")
                      .data(data)
                      .enter()
                      .append("g")
                      .attr("class", "row");
          var bars = groups
                      .append("rect")
                      .attr("x", function (d, i) {return that.x(Math.min(0, d));})
                      .attr("y", function (d,i) {return that.y(i);})
                      .attr("width", function(d, i){return Math.abs(that.x(d) - that.x(0));})
                      .attr("height", this.y.rangeBand())
                      .attr("class", "playerAvgBars")
                      .attr("fill", function(d){
                          // if this is a negative value
                          if(d < 0){
                              return "red";
                          }
                          else
                              return "green";
                      });
        }
      }

    function addPlayerName(player){
      var info = player.name + ", " + player.position;
        d3.select("#playerName")
          .html([info])
    }

    function addTeamImage(playerData){
      // teamAbbrev will be used to determine the link
      var teamAbbrev;
      // make adjustments for exceptions
      switch(playerData.team){
        case "GS": 
          teamAbbrev = "GSW";
          break;
        case "NO":
          teamAbbrev = "NOP";
          break;
        case "NY":
          teamAbbrev = "NYK";
          break;
        case "PHO":
          teamAbbrev = "PHX";
          break;
        case "SA": 
          teamAbbrev = "SAS";
          break;
        default:
          teamAbbrev = playerData.team;
          break;
      }

     var team = d3.select("#teamimg")
     var teamimg = team.selectAll("img")
              .data([1])
              .enter().append("img")
              .attr("class", "teamimg") 
              .attr("src", "http://stats.nba.com/media/img/teams/logos/"+teamAbbrev+"_logo.svg")    
    }
      
    // used to generate team image links
    function reverseLookup(value){
      for (iter in teamLookup){
        if (teamLookup.hasOwnProperty(iter)){
          if(teamLookup[iter] == value)
            return iter;
        }
      }
    }
   
  var imgaa = d3.select("#playerimg")
   var image = imgaa.selectAll("img")
              .data([77])
              .enter().append("img")
              .attr("class","playerimg")
              .attr("src", indPlayerData["photo"])

   var text = d3.select("#playerdetails")
   var columns = Object.keys(indPlayerData.seasons[0]);

  }
    
  // initVis loads the data
  function initVis(){
    // initialize the teamPlayersList
    teamPlayersList = get2DArray(30);  
    d3.json('data/nba.json', function(error, data){
      playerData = data;
      for(var i in playerData){
        playerNamesList.push(playerData[i].name);
      };
    })
    loadTeamNavBar();

  }
  /* 
  * HELPER FUNCTIONS BELOW
  */
  // function to create an empty 2D-array. We'll use this to setup memoization 
  //for team players so we don't need to iterate too much over the large JSON file that we have
  // source: http://stackoverflow.com/questions/6495187/best-way-to-generate-empty-2d-array
  function get2DArray(size) {
    size = size > 0 ? size : 0;
    var arr = [];
    while(size--) {
        arr.push([]);
    }
    return arr;
  }
  // isEmpty checks to see if an array is empty
  // source: http://stackoverflow.com/questions/11743392/check-if-array-is-empty-or-exists
  function isEmpty(array){
    return typeof array != "undefined"
      && array != null
      && array.length != null
      && array.length > 0
  }
  // used to generate team image links
  function reverseLookup(value){
    for (iter in teamLookup){
      if (teamLookup.hasOwnProperty(iter)){
        if(teamLookup[iter] == value)
          return iter;
      }
    }
  }
  initVis();

</script> 
</body>

</html>